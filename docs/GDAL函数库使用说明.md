# GDALå‡½æ•°åº“ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æ ¹æ®æ‚¨æä¾›çš„ã€ŠGISç©ºé—´åˆ†æå¸¸è§„åŠŸèƒ½éœ€æ±‚.pdfã€‹æ–‡æ¡£ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„GDALå‡½æ•°åº“JSONæ–‡æ¡£ï¼ŒåŒ…å«äº†PDFä¸­æåˆ°çš„æ‰€æœ‰GISåˆ†ææ–¹æ³•ï¼Œå¹¶æŒ‰åŠŸèƒ½åˆ†ç±»ç»„ç»‡ã€‚

## ğŸ¯ ä¸»è¦åŠŸèƒ½è¦†ç›–

### 1. åæ ‡è½¬æ¢åŠŸèƒ½ï¼ˆå®Œå…¨å¯¹åº”PDFéœ€æ±‚ï¼‰
- âœ… **åœ°ç†åæ ‡ç³»è½¬æ¢**ï¼šæ ‡å‡†åœ°ç†åæ ‡ç³»è½¬æ¢
- âœ… **æŠ•å½±åæ ‡ç³»è½¬æ¢**ï¼šæ ‡å‡†æŠ•å½±åæ ‡ç³»ã€å·¥ç¨‹åæ ‡ç³»
- âœ… **åæ ‡æŸ¥è¯¢**ï¼šå½“å‰æ•°æ®æŸ¥è¯¢ã€å½“å‰å›¾å±‚æŸ¥è¯¢

### 2. çŸ¢é‡åˆ†æåŠŸèƒ½ï¼ˆå®Œå…¨å¯¹åº”PDFéœ€æ±‚ï¼‰

#### å¸¸è§„åˆ†æ
- âœ… **æ„å»ºç¼“å†²åŒº**ï¼šç‚¹ã€çº¿ã€é¢ç¼“å†²åŒºåˆ†æ
- âœ… **è£å‰ªåˆ†æ**ï¼šçº¿â†’é¢ã€çº¿â†’çº¿ã€é¢â†’é¢
- âœ… **ç›¸äº¤åˆ†æ**ï¼šçº¿â†’é¢ã€çº¿â†’çº¿ã€é¢â†’é¢ï¼ˆçº¿çº¿ç›¸äº¤å¾—åˆ°ç‚¹ï¼‰
- âœ… **å·®é›†åˆ†æ**ï¼šé¢â†’é¢ã€çº¿â†’çº¿ã€ç‚¹â†’ç‚¹
- âœ… **èåˆåˆ†æ**ï¼šç‚¹ã€çº¿ã€é¢ï¼ŒæŒ‰ç›®æ ‡å­—æ®µåˆå¹¶åŒç±»é¡¹
- âœ… **è”åˆåˆ†æ**ï¼šé¢â†’é¢ã€çº¿â†’çº¿ã€ç‚¹â†’ç‚¹ï¼Œå¤šä¸ªæ•°æ®æ„å»ºæ›´å¤§åŒºåŸŸ
- âœ… **åˆå¹¶å›¾å±‚**ï¼šç‚¹ã€çº¿ã€é¢ï¼Œå¤šè¡¨åˆå¹¶

#### éå¸¸è§„åˆ†æ
- âœ… **æŒ‰å±æ€§å­—æ®µè¿æ¥å›¾å±‚**ï¼šä»»æ„ç±»å‹çŸ¢é‡è¦ç´ é—´çš„åŒå­—æ®µè¿æ¥
- âœ… **æŒ‰å±æ€§å­—æ®µæå–è¦ç´ **ï¼šå±æ€§ç­›é€‰åŠŸèƒ½
- âœ… **æŒ‰å±æ€§å­—æ®µé€‰æ‹©è¦ç´ **ï¼šåœ¨è§†å£ä¸­æŒ‰å±æ€§è¿‡æ»¤æ˜¾ç¤º

### 3. æ …æ ¼åˆ†æåŠŸèƒ½ï¼ˆå®Œå…¨å¯¹åº”PDFéœ€æ±‚ï¼‰

#### å¸¸è§„åˆ†æ
- âœ… **DEMé«˜ç¨‹åˆ†æ**ï¼šå¡åº¦åˆ†æã€å¹³æ•´åº¦åˆ†æ
- âœ… **æå–ç­‰é«˜çº¿**ï¼šä»DEMç”Ÿæˆç­‰é«˜çº¿
- âœ… **DOMå½±åƒæ‹¼æ¥**ï¼šå¤šå½±åƒæ‹¼æ¥å¤„ç†
- âœ… **å¤šæœŸå½±åƒå åŠ åˆ†æ**ï¼šå˜åŒ–æ£€æµ‹å’ŒåŠ¨æ€å¯¹æ¯”

#### é¥æ„Ÿåˆ†æ
- âœ… **NDVIæ¤è¢«æŒ‡æ•°è®¡ç®—**ï¼šæ¤è¢«åˆ†æ
- âœ… **å½±åƒå˜åŒ–æ£€æµ‹**ï¼šå¤šæœŸå¯¹æ¯”åˆ†æ

### 4. è¡¨æ ¼åˆ†æåŠŸèƒ½ï¼ˆå®Œå…¨å¯¹åº”PDFéœ€æ±‚ï¼‰
- âœ… **å¸¦åœ°ç†åæ ‡çš„CSV**ï¼šæ·»åŠ åˆ°é¡µé¢å¹¶å¯è§†åŒ–

## ğŸ—ï¸ JSONç»“æ„è¯´æ˜

### ä¸»è¦ç»“æ„
```json
{
  "gdal_functions": {
    "coordinate_operations": {},    // åæ ‡æ“ä½œ
    "vector_analysis": {},         // çŸ¢é‡åˆ†æ
    "raster_analysis": {},         // æ …æ ¼åˆ†æ
    "table_analysis": {},          // è¡¨æ ¼åˆ†æ
    "raster_operations": {},       // æ …æ ¼æ“ä½œ
    "utility_operations": {},      // å®ç”¨å·¥å…·
    "specialized_operations": {},   // ä¸“ä¸šåˆ†æ
    "common_patterns": {}          // å¸¸ç”¨æ¨¡å¼
  },
  "metadata": {}                   // å…ƒæ•°æ®ä¿¡æ¯
}
```

### æ¯ä¸ªå‡½æ•°åŒ…å«çš„ä¿¡æ¯
```json
{
  "function_name": "å‡½æ•°å",
  "description": "åŠŸèƒ½æè¿°",
  "category": "åŠŸèƒ½åˆ†ç±»",
  "input_types": ["è¾“å…¥æ•°æ®ç±»å‹"],
  "parameters": {
    "å‚æ•°å": {
      "type": "å‚æ•°ç±»å‹",
      "description": "å‚æ•°æè¿°",
      "required": true/false,
      "example": "ç¤ºä¾‹å€¼",
      "options": ["å¯é€‰å€¼åˆ—è¡¨"]
    }
  },
  "python_template": "Pythonä»£ç æ¨¡æ¿",
  "command_template": "å‘½ä»¤è¡Œæ¨¡æ¿",
  "examples": [
    {
      "description": "ç¤ºä¾‹æè¿°",
      "code": "ç¤ºä¾‹ä»£ç "
    }
  ]
}
```

## ğŸ’» å‰ç«¯ä½¿ç”¨æ–¹æ³•

### 1. è¯»å–JSONæ•°æ®
```javascript
// åœ¨Vueç»„ä»¶ä¸­åŠ è½½GDALå‡½æ•°åº“
import gdalFunctions from './GDALå‡½æ•°åº“.json'

export default {
  data() {
    return {
      gdalLib: gdalFunctions.gdal_functions,
      currentCategory: null,
      selectedFunction: null,
      parameters: {}
    }
  }
}
```

### 2. æ„å»ºåŠŸèƒ½åˆ†ç±»åˆ—è¡¨
```javascript
// è·å–æ‰€æœ‰åŠŸèƒ½åˆ†ç±»
const categories = Object.keys(this.gdalLib)

// æ„å»ºåˆ†ç±»èœå•
const categoryMenu = categories.map(cat => ({
  name: cat,
  label: this.getCategoryLabel(cat),
  functions: Object.keys(this.gdalLib[cat])
}))
```

### 3. ç”Ÿæˆå‚æ•°é…ç½®ç•Œé¢
```javascript
// æ ¹æ®é€‰ä¸­çš„å‡½æ•°ç”Ÿæˆå‚æ•°è¡¨å•
generateParameterForm(functionDef) {
  const parameters = functionDef.parameters
  const formItems = []
  
  Object.keys(parameters).forEach(paramName => {
    const param = parameters[paramName]
    formItems.push({
      name: paramName,
      label: param.description,
      type: param.type,
      required: param.required,
      options: param.options,
      example: param.example,
      default: param.default
    })
  })
  
  return formItems
}
```

### 4. ç”ŸæˆPythonä»£ç 
```javascript
// æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å‚æ•°ç”Ÿæˆå¯æ‰§è¡Œçš„Pythonä»£ç 
generatePythonCode(functionDef, userParams) {
  let template = functionDef.python_template
  
  // æ›¿æ¢æ¨¡æ¿ä¸­çš„å‚æ•°å ä½ç¬¦
  Object.keys(userParams).forEach(paramName => {
    const value = userParams[paramName]
    const placeholder = `{${paramName}}`
    template = template.replace(new RegExp(placeholder, 'g'), value)
  })
  
  return template
}
```

### 5. æ„å»ºå®Œæ•´çš„ç•Œé¢ç»„ä»¶

```vue
<template>
  <div class="gdal-calculator">
    <!-- åŠŸèƒ½åˆ†ç±»é€‰æ‹© -->
    <el-menu @select="onCategorySelect">
      <el-submenu v-for="category in categories" :key="category.name">
        <span slot="title">{{ category.label }}</span>
        <el-menu-item 
          v-for="func in category.functions" 
          :key="func"
          @click="selectFunction(category.name, func)">
          {{ gdalLib[category.name][func].description }}
        </el-menu-item>
      </el-submenu>
    </el-menu>
    
    <!-- å‚æ•°é…ç½®é¢æ¿ -->
    <div v-if="selectedFunction" class="parameter-panel">
      <h3>{{ selectedFunction.description }}</h3>
      
      <el-form :model="parameters" label-width="120px">
        <el-form-item 
          v-for="param in parameterList" 
          :key="param.name"
          :label="param.label"
          :required="param.required">
          
          <!-- æ–‡ä»¶é€‰æ‹©å™¨ -->
          <el-select v-if="param.type === 'string' && param.name.includes('input')"
                     v-model="parameters[param.name]"
                     placeholder="é€‰æ‹©æ–‡ä»¶">
            <el-option v-for="file in availableFiles" 
                       :key="file.name" 
                       :label="file.name" 
                       :value="file.path"/>
          </el-select>
          
          <!-- æ•°å€¼è¾“å…¥ -->
          <el-input-number v-else-if="param.type === 'number'"
                           v-model="parameters[param.name]"
                           :placeholder="param.example"/>
          
          <!-- é€‰é¡¹é€‰æ‹© -->
          <el-select v-else-if="param.options"
                     v-model="parameters[param.name]"
                     :placeholder="param.default">
            <el-option v-for="option in param.options" 
                       :key="option" 
                       :label="option" 
                       :value="option"/>
          </el-select>
          
          <!-- æ™®é€šæ–‡æœ¬è¾“å…¥ -->
          <el-input v-else 
                    v-model="parameters[param.name]"
                    :placeholder="param.example"/>
        </el-form-item>
      </el-form>
      
      <!-- ä»£ç é¢„è§ˆ -->
      <div class="code-preview">
        <h4>ç”Ÿæˆçš„Pythonä»£ç ï¼š</h4>
        <pre><code>{{ generatedCode }}</code></pre>
      </div>
      
      <!-- æ‰§è¡ŒæŒ‰é’® -->
      <el-button type="primary" @click="executeCode">æ‰§è¡Œåˆ†æ</el-button>
    </div>
  </div>
</template>

<script>
export default {
  name: 'GdalCalculator',
  data() {
    return {
      gdalLib: require('./GDALå‡½æ•°åº“.json').gdal_functions,
      selectedFunction: null,
      parameters: {},
      availableFiles: [] // ä»æ–‡ä»¶ç®¡ç†ç³»ç»Ÿè·å–
    }
  },
  computed: {
    categories() {
      return Object.keys(this.gdalLib).map(cat => ({
        name: cat,
        label: this.getCategoryLabel(cat),
        functions: Object.keys(this.gdalLib[cat])
      }))
    },
    parameterList() {
      if (!this.selectedFunction) return []
      return Object.keys(this.selectedFunction.parameters).map(paramName => ({
        name: paramName,
        ...this.selectedFunction.parameters[paramName]
      }))
    },
    generatedCode() {
      if (!this.selectedFunction) return ''
      return this.generatePythonCode(this.selectedFunction, this.parameters)
    }
  },
  methods: {
    selectFunction(category, functionName) {
      this.selectedFunction = this.gdalLib[category][functionName]
      this.parameters = {}
      
      // è®¾ç½®é»˜è®¤å€¼
      Object.keys(this.selectedFunction.parameters).forEach(paramName => {
        const param = this.selectedFunction.parameters[paramName]
        if (param.default !== undefined) {
          this.parameters[paramName] = param.default
        }
      })
    },
    
    generatePythonCode(functionDef, userParams) {
      let template = functionDef.python_template
      Object.keys(userParams).forEach(paramName => {
        const value = userParams[paramName]
        template = template.replace(new RegExp(`{${paramName}}`, 'g'), value)
      })
      return template
    },
    
    async executeCode() {
      try {
        const response = await this.$http.post('/api/gdal/execute', {
          code: this.generatedCode,
          function_name: this.selectedFunction.function_name,
          parameters: this.parameters
        })
        
        if (response.data.success) {
          this.$message.success('æ‰§è¡ŒæˆåŠŸ')
          // å¤„ç†ç»“æœï¼Œæ›´æ–°åœ°å›¾æ˜¾ç¤ºç­‰
          this.handleExecutionResult(response.data.result)
        } else {
          this.$message.error('æ‰§è¡Œå¤±è´¥ï¼š' + response.data.error)
        }
      } catch (error) {
        this.$message.error('æ‰§è¡Œå‡ºé”™ï¼š' + error.message)
      }
    },
    
    getCategoryLabel(category) {
      const labels = {
        coordinate_operations: 'åæ ‡æ“ä½œ',
        vector_analysis: 'çŸ¢é‡åˆ†æ',
        raster_analysis: 'æ …æ ¼åˆ†æ',
        table_analysis: 'è¡¨æ ¼åˆ†æ',
        raster_operations: 'æ …æ ¼æ“ä½œ',
        utility_operations: 'å®ç”¨å·¥å…·',
        specialized_operations: 'ä¸“ä¸šåˆ†æ'
      }
      return labels[category] || category
    }
  }
}
</script>
```

## ğŸ”§ åç«¯é›†æˆæ–¹æ¡ˆ

### 1. åˆ›å»ºGDALæ‰§è¡Œè·¯ç”±
```python
# backend/routes/gdal_routes.py
from flask import Blueprint, request, jsonify
from services.gdal_execution_service import GdalExecutionService

gdal_bp = Blueprint('gdal', __name__)

@gdal_bp.route('/execute', methods=['POST'])
def execute_gdal():
    data = request.json
    code = data.get('code')
    function_name = data.get('function_name')
    parameters = data.get('parameters', {})
    
    try:
        service = GdalExecutionService()
        result = service.execute_safe(code, function_name, parameters)
        return jsonify({'success': True, 'result': result})
    except Exception as e:
        return jsonify({'success': False, 'error': str(e)})
```

### 2. å®‰å…¨æ‰§è¡ŒæœåŠ¡
```python
# backend/services/gdal_execution_service.py
import subprocess
import tempfile
import os
from pathlib import Path

class GdalExecutionService:
    def __init__(self):
        self.temp_dir = Path(tempfile.gettempdir()) / 'gdal_execution'
        self.temp_dir.mkdir(exist_ok=True)
    
    def execute_safe(self, code, function_name, parameters):
        # éªŒè¯ä»£ç å®‰å…¨æ€§
        if not self.validate_code(code):
            raise ValueError("ä»£ç åŒ…å«ä¸å®‰å…¨çš„æ“ä½œ")
        
        # åˆ›å»ºä¸´æ—¶æ‰§è¡Œæ–‡ä»¶
        script_file = self.temp_dir / f'{function_name}_{os.getpid()}.py'
        
        try:
            with open(script_file, 'w', encoding='utf-8') as f:
                f.write(code)
            
            # åœ¨å®¹å™¨ä¸­æ‰§è¡Œ
            result = self.execute_in_container(script_file)
            return result
            
        finally:
            # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            if script_file.exists():
                script_file.unlink()
    
    def validate_code(self, code):
        # æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦åŒ…å«å±é™©æ“ä½œ
        dangerous_keywords = ['import os', 'subprocess', 'eval', 'exec', '__import__']
        return not any(keyword in code for keyword in dangerous_keywords)
    
    def execute_in_container(self, script_file):
        # ä½¿ç”¨Dockerå®¹å™¨æ‰§è¡ŒGDALä»£ç 
        cmd = [
            'docker', 'run', '--rm',
            '-v', f'{self.temp_dir}:/workspace',
            '-v', f'{self.get_data_dir()}:/data',
            'osgeo/gdal:alpine-small-latest',
            'python', f'/workspace/{script_file.name}'
        ]
        
        result = subprocess.run(cmd, capture_output=True, text=True)
        
        if result.returncode != 0:
            raise Exception(f"æ‰§è¡Œå¤±è´¥: {result.stderr}")
        
        return result.stdout
```

## ğŸ“Š ä½¿ç”¨ç»Ÿè®¡å’Œåˆ†æ

è¯¥JSONåº“æä¾›çš„åŠŸèƒ½å®Œå…¨è¦†ç›–äº†PDFæ–‡æ¡£ä¸­æåˆ°çš„éœ€æ±‚ï¼š

### âœ… å®Œå…¨å®ç°çš„åŠŸèƒ½
1. **åæ ‡è½¬æ¢** - 2ä¸ªå‡½æ•°
2. **çŸ¢é‡åˆ†æ** - 8ä¸ªä¸»è¦åˆ†æåŠŸèƒ½
3. **æ …æ ¼åˆ†æ** - 4ä¸ªä¸»è¦åˆ†æåŠŸèƒ½  
4. **è¡¨æ ¼åˆ†æ** - 1ä¸ªè½¬æ¢åŠŸèƒ½
5. **æ‰©å±•åŠŸèƒ½** - 30+ ä¸ªå…¶ä»–GDAL/OGRå‡½æ•°

### ğŸ“ˆ æ€»è®¡
- **45ä¸ªGDALå‡½æ•°**
- **8ä¸ªåŠŸèƒ½åˆ†ç±»**
- **å®Œæ•´çš„å‚æ•°å®šä¹‰**
- **Pythonå’Œå‘½ä»¤è¡Œæ¨¡æ¿**
- **å®é™…ä»£ç ç¤ºä¾‹**

è¿™ä¸ªJSONæ–‡æ¡£å¯ä»¥ç›´æ¥ç”¨äºæ‚¨çš„å‰ç«¯ç•Œé¢ï¼Œè®©ç”¨æˆ·é€šè¿‡å›¾å½¢åŒ–é…ç½®ç”ŸæˆGDALä»£ç å¹¶æ‰§è¡ŒGISåˆ†æä»»åŠ¡ï¼ 